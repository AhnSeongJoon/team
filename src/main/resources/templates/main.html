<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>상품 전시 페이지</title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="https://bxgs.co.kr/theme/buzinga/css/aos.css?ver=210618">
    <link rel="stylesheet" href="https://bxgs.co.kr/theme/buzinga/css/nice-select.css?ver=210618">
    <link rel="stylesheet" href="https://bxgs.co.kr/theme/buzinga/css/common.css?ver=210618">
    <link rel="stylesheet" href="https://bxgs.co.kr/theme/buzinga/css/sub.css?ver=210618">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap JS -->
    <script th:inline="javascript" src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script th:inline="javascript" src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // 초기값으로 0~6번째 게시물만 출력받도록 설정
    var offset = 0;
    var limit = 6;
    var searchQuery = '';
    var selectedCategory = ''; // 카테고리 선택을 위한 변수 추가



        $(document).ready(function(){
            console.log("abc")
                // 게시글 목록 출력
                postListDisplay(offset, limit);

                if (postScroll === true) {
                    // 무한스크롤 함수 실행
                    $(window).scroll(scrollHandler);

                }
                // 검색 버튼 클릭 시 검색 수행
                      $('#searchButton').click(function() {
                          searchQuery = $('#searchInput').val().trim();
                          offset = 0; // 검색 시 오프셋을 초기화
                          $('#postList').empty(); // 검색 결과를 위해 게시글 목록 비우기
                          postListDisplay(offset, limit);
                        });

              // 카테고리 선택 이벤트 처리
              $('#categoryFilter').change(function() {
                  selectedCategory = $(this).val();
                  offset = 0; // 카테고리 변경 시 오프셋을 초기화
                  $('#postList').empty(); // 선택된 카테고리에 맞는 게시글을 불러오기 위해 목록 비우기
                  postListDisplay(offset, limit);
              });
          });


            // 무한 스크롤 기능
            function scrollHandler() {
          //console.log("Scroll event detected");
          //console.log("ScrollTop:", $(window).scrollTop());
          //console.log("Window height:", $(window).height());
          //console.log("Document height:", $(document).height());

                // 스크롤이 화면 가장 아래에 닿으면 실행됨
                if (postScroll === true && $(window).scrollTop() + $(window).height() >= $(document).height() - 30) {
                    // 초기값은 limit 값을 더한 값으로 설정
                    offset += limit;
                    // 변경된 초기값으로 다시 목록이 출력됨
                    postListDisplay(offset, limit);
                }
            }

            //게시글 목록 출력
            function postListDisplay(offset, limit) {
                postScroll = true;

                $.ajax({
                    method: "GET",
                    url: "/main/list",

                    data: {"offset": offset
                            , "limit": limit
                            , "searchQuery": searchQuery, // 검색어 추가
                               "category": selectedCategory // 카테고리 필터 추가
                        },
                    dataType: "json",
                    success: function(result) {
                        console.log(result);
                        // 출력 데이터가 없다면 무한스크롤을 false(중지상태)로 설정
                        if (result.length === 0) {
                            postScroll = false;
                        // 출력 데이터가 16이하이면 목록 출력하고 무한스크롤 false 상태로 변경
                        } else if(result.length < 6) {
                            for (var i = 0; i < result.length; i++) {
                                var postList = result[i];
                        var postElement2 = $("<div class='col'>" +
          "<div class='card'>" +
            "<a href='/item/" + postList.id + "' class='text-dark'>" +
                "<img src='" + postList.imgUrl + "' class='card-img-top' alt='" + postList.itemNm + "'>" +
                "<div class='card-body d-flex flex-column'>" +
                    // 제목을 맨 위에 위치시킵니다.
                    "<h4 class='card-title'>" + postList.itemNm + "</h4>" +

                    // 가격을 맨 아래에 위치시킵니다.
                    "<h3 class='card-price text-danger mt-auto'>" + postList.price + " 원</h3>" +
                "</div>" +
            "</a>" +
          "</div>" +
          "</div>");

                                $("#postList").append(postElement2);
                            }
                            postScroll = false;
                        // 데이터가 16개 초과이면 16개까지만 출력하고 무한스크롤 상태 true 로 유지됨
                        } else {
                            for (var i = 0; i < result.length; i++) {
                                var postList = result[i];
                        var postElement2 = $("<div class='col'>" +
          "<div class='card'>" +
            "<a href='/item/" + postList.id + "' class='text-dark'>" +
                "<img src='" + postList.imgUrl + "' class='card-img-top' alt='" + postList.itemNm + "'>" +
                "<div class='card-body d-flex flex-column'>" +
                    // 제목을 맨 위에 위치시킵니다.
                    "<h4 class='card-title'>" + postList.itemNm + "</h4>" +

                    // 가격을 맨 아래에 위치시킵니다.
                    "<h3 class='card-price text-danger mt-auto'>" + postList.price + " 원</h3>" +
                "</div>" +
            "</a>" +
          "</div>" +
          "</div>");

           postElement2.find('.card-title').text(postList.itemNm);
                         postElement2.find('.card-text').text(postList.itemDetail);
                         postElement2.find('.card-price').text(postList.price + '원');

                                $("#postList").append(postElement2);
                            }
                        }
                    },
                    error: function(error) {
                      console.log(error);
                    }
                });
            }


    </script>
    </th:block>
    <style>
        /* 전체 카드 디자인 */
        .card {
            position: relative;
            border: none;
            overflow: hidden;
            border-radius: 10px;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }

        .card:hover {
            transform: scale(1.03); /* 마우스 오버 시 카드가 커지도록 설정 */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.0); /* 마우스 오버 시 카드의 그림자 효과를 더 진하게 설정 */
            border-radius: 0 0 0 0; /* 모든 모서리를 각지게 */
        }

        /* 이미지 설정 */
        .card img {
            height: 200px;
            width: 100%;
            object-fit: cover;
            border-radius: 10px 10px 0 0;
        }
        .card:hover img {
            transform: scale(1.1); /* 마우스 오버 시 이미지가 커지도록 설정 */
            border-radius: 10px; /* 카드의 모서리를 둥글게 설정 */
        }

        /* 카드 본문 설정 */
        .card-body {
            padding: 15px;
            text-align: center;
        }
        .card-title {
                font-size: 18px;
                font-weight: bold;
                margin-bottom: 10px;
                color: #333;
        }

     .card-price {
            color: #c9ab81;
            font-size: 16px;
            margin-top: 10px;
        }

     a {
       text-decoration: none;
       }

         /* 슬라이드 컨트롤 스타일 */
    .carousel-control-prev, .carousel-control-next {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 1;
    }

        /*헤더 글씨 동작 및 위치*/
        .carousel-caption {
            font-family: 'Roboto', sans-serif; /* 캡션의 글꼴을 Roboto 로 설정 */
            position: absolute; /* 캡션의 위치를 절대적으로 설정 */
            bottom: 20px; /* 캡션을 슬라이드 하단에서 20px 위로 설정 */
            left: 20px; /* 캡션을 슬라이드 왼쪽에서 20px 오른쪽으로 설정 */
            width: calc(100% - 40px); /* 캡션의 너비를 슬라이드의 너비에서 40px을 뺀 값으로 설정 */
            text-align: left; /* 캡션의 텍스트를 왼쪽 정렬 */
            animation: slideInFromBottom 1s ease-in-out; /* 캡션에 천천히 올라오는 애니메이션을 설정 */transition: transform 0.5s ease-in-out; /* 변환 효과 설정 */
        }
        /*헤더 글씨*/
        .carousel-caption h5 {
            font-size: 2rem; /* 캡션 제목의 글꼴 크기를 설정 */
            font-weight: bold; /* 캡션 제목의 글꼴 두께를 굵게 설정 */
            color: #fff; /* 캡션 제목의 글꼴 색상을 흰색으로 설정 */
            margin-bottom: 10px; /* 캡션 제목 아래 여백을 설정 */
        }
        /*헤더 글씨*/
        .carousel-caption p {
            font-size: 1.2rem; /* 캡션 설명의 글꼴 크기를 설정 */
            color: #fff; /* 캡션 설명의 글꼴 색상을 흰색으로 설정 */
        }

        /* 레이아웃 및 간격 */
        .row-cols-md-3 .col {
            margin-bottom: 20px; /* 카드 아래 여백을 20px로 설정 */
        }

        .header-carousel-item img:hover {
            transform: scale(1.1); /* 마우스 오버 시 이미지가 커지도록 설정 */
        }

        .carousel-item {
            transition: opacity 0.5s ease-in-out; /* 슬라이드 항목의 불투명도 변환 효과를 설정 */
        }
         /* 카테고리 필터 가운데 정렬 */
        .filter-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        body {
            background-image: url('/img/over2.jpg'); /* 이미지 경로 설정 */
            background-size: cover; /* 이미지를 화면에 맞게 조정 */
            background-position: center; /* 이미지의 중앙을 기준으로 배치 */
            background-repeat: no-repeat; /* 이미지 반복 제거 */
            background-attachment: fixed; /* 배경 이미지 고정 */
        }
        .content {
            padding: 20px;
            color: white; /* 텍스트 색상 설정 */
        }

        /* 이미지 위에 덮일 수 있는 반투명한 오버레이 추가 */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* 반투명 검정색 오버레이 */
            z-index: 0; /* 내용보다 아래에 표시되도록 설정 */
            pointer-events: none; /* 오버레이는 클릭 이벤트를 차단하지 않음 */

        }

        .row {
            position: relative;
            z-index: 2;
        }

        /* 4열 상품 배치 */
        .row-cols-md-4 .col {
            margin-bottom: 20px;
        }


    </style>


</head>


<!-- 무한 스크롤 JS -->
<div th:replace="~{fragments/header::header}" class="header"></div>

<body>
    <div class="row" style="margin-top: 30px; display: flex; justify-content: center;">
        <div class="col-md-12">
            <div class="filter-container">
                <select id="categoryFilter" class="form-select" style="width: 400px">
                    <option value="">모든 카테고리</option>
                    <option value="반지">반지</option>
                    <option value="팔찌">팔찌</option>
                    <option value="목걸이">목걸이</option>
                    <option value="귀걸이">귀걸이</option>
                </select>
            </div>
        </div>
    </div>
    <div id="postList" class="row row-cols-1 row-cols-md-4 g-4"
         style="margin-top: 40px; ">
    </div>
</body>
</html>
